#!/data/data/com.termux/files/usr/bin/bash

url="$1"
if [ -z "$url" ]; then
  echo "Usage: yt-transcript <YouTube URL>"
  exit 1
fi

# Download subtitles only
yt-dlp --write-auto-sub --sub-lang en --skip-download "$url"

# Get video ID and locate .vtt
video_id=$(yt-dlp --get-id "$url")
vtt_file=$(ls *"$video_id"*.en.vtt | head -n1)

# Convert to clean Markdown text
if [ -f "$vtt_file" ]; then
  outfile="${video_id}_transcript.md"
  sed -e '/^[0-9]*:[0-9]*:[0-9]*\./d' -e '/^$/d' "$vtt_file" > "$outfile"
  echo "✅ Saved: $outfile"
  rm "$vtt_file"
else
  echo "❌ .vtt file not found"
fi
